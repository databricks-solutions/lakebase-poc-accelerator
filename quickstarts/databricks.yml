# This is a Databricks asset bundle definition for lakebase_accelerator.
# See https://docs.databricks.com/dev-tools/bundles/index.html for documentation.
bundle:
  name: lakebase_accelerator
  uuid: 5fec423c-234a-4869-a92b-766f76f6f70f

include:
  - resources/*.yml

resources:
#  Provision Lakebase database instance
#  https://docs.databricks.com/aws/en/dev-tools/bundles/resources#database_instances
  database_instances:
    my_instance:
      name: lakebase-instance
      capacity: CU_1
# Register Lakebase database as a read-only UC catalog to enable federated queries + data governance
  database_catalogs:
    my_catalog:
      database_instance_name: ${resources.database_instances.my_instance.name}
      name: lakebase_catalog
      database_name: my_database
      create_database_if_not_exists: true
# Define synced table: https://docs.databricks.com/aws/en/dev-tools/bundles/resources#synced_database_tables
  synced_database_tables:
    my_synced_table:
      name: ${resources.database_catalogs.my_catalog.name}.public.destination_table
      database_instance_name: ${resources.database_catalogs.my_catalog.database_instance_name}
      logical_database_name: ${resources.database_catalogs.my_catalog.database_name}
      spec:
        source_table_full_name: 'source_catalog.source_schema.source_table'
        scheduling_policy: TRIGGERED
        primary_key_columns:
          - pk_id
        new_pipeline_spec:
          storage_catalog: 'source_catalog'
          storage_schema: 'source_schema'


targets:
  dev:
    # The default target uses 'mode: development' to create a development copy.
    # - Deployed resources get prefixed with '[dev my_user_name]'
    # - Any job schedules and triggers are paused by default.
    # See also https://docs.databricks.com/dev-tools/bundles/deployment-modes.html.
    mode: development
    default: true
    workspace:
      host: https://myworkspace.cloud.databricks.com

  prod:
    mode: production
    workspace:
      host: https://myworkspace.cloud.databricks.com
